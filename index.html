<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-signin-client_id"
        content="949665082180-m5ob4j0tj68s644uue3dibcp8f1r0l60.apps.googleusercontent.com">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Knewave&display=swap" rel="stylesheet">
</head>
<title>Hello, Me!</title>
</head>

<body>
    <div class="preloader">
        <div class="loading">
            <img src="img/loading.gif" width="80">
            <p>Harap Tunggu</p>
        </div>
    </div>

    <div class="container" id="signUp-page">
        <div class="row">
            <div class="col-sm-8">
                <div id="img-signup">
                    <img src="img/img-register.svg" style="width: 100%; left: 50%; position: relative;">
                </div>
                <h4 class="head-register"><strong>SIGN UP</strong></h4>
            </div>
            <div class="col-sm-4">
                <div id="form-signUp">
                    <form method="" id="f-signUp">
                        <div class="form-group">
                            <label for="name">Name</label>
                            <input type="text" class="form-control form-control-sm" name="name" id="signup-name">
                            <small class="form-text" style="color: #FFA863;">enter your name</small>
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" class="form-control form-control-sm" name="email" id="signup-email">
                            <small class="form-text" style="color: #FFA863;">We'll never share your email with anyone
                                else</small>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" class="form-control form-control-sm" name="password"
                                id="signup-password">
                            <small class="form-text" style="color: #FFA863;">enter your password</small>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-outline-info btn-sm">Submit</button>
                        </div>
                        <div align="center">
                            <br>
                            <span><small>have an account ?</small></span>
                            <a href="" id="link-signIn"><small>SignIn</small></a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <div class="container" id="signIn-page">
        <div class="row">
            <div class="col-sm-8">
                <div id="img-signup">
                    <img src="img/img-login.svg" style="width: 90%; left: 50%; position: relative;">
                </div>
                <h4 class="head-login">SIGN IN</h4>
            </div>
            <div class="col-sm-4">
                <div id="form-signIn">
                    <form method="" id="f-signIn">
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" class="form-control form-control-sm" name="email" id="signin-email">
                            <small class="form-text" style="color: #FFA863;">We'll never share your email with anyone
                                else</small>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" class="form-control form-control-sm" name="password"
                                id="signin-password">
                            <small class="form-text" style="color: #FFA863;">enter your password</small>
                        </div>
                        <button type="submit" class="btn btn-outline-info btn-sm">Log In</button>
                        <div class="g-signin2" data-width="30" data-height="30" data-longtitle="true"
                            data-onsuccess="onSignIn"></div>
                        <div align="center">
                            <br>
                            <span><small>don't have an account ?</small></span>
                            <a href="" id="link-signUp"><small>SignUp</small></a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="content-page" style="background-color: rgba(255, 168, 97, 0.07);">
        <nav class="navbar navbar-expand-lg navbar-light">
            <a class="navbar-brand" href="#">
                <h2 style="color: #FFA863;">Predict Me!</h2>
            </a>
            <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
                <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                    <li class="nav-item active"></li>
                    <li class="nav-item"></li>
                    <li class="nav-item"></li>
                </ul>
                <form class="form-inline my-2 my-lg-0" id="form-signOut">
                    <button class="btn btn-outline-danger btn-sm my-2 my-sm-0" type="submit">Log Out</button>
                </form>
            </div>
        </nav>
        <div class="container">
            <form class="form-inline" style="margin-top: -4%; margin-left: 30%;" method="" id="form-content">
                <div class="form-group">
                    <label for="name">input your name</label>
                    <input type="text" class="form-control mx-sm-3" name="name" id="content-name">
                    <button type="submit" class="btn btn-outline-dark btn-sm">try</button>
                </div>
            </form>
        </div>
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="card border-warning mb-3" style="max-width: 20rem;">
                        <div class="card-header"><strong>Gender</strong></div>
                        <div class="card-body">
                            <h3 class="card-text" id="data-gender" align="center"></h3>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card border-info mb-3" style="max-width: 18rem;">
                        <div class="card-header"><strong>Age</strong></div>
                        <div class="card-body">
                            <h3 class="card-text" id="data-age" align="center"></h3>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card border-success mb-3" style="max-width: 18rem;">
                        <div class="card-header"><strong>Nationality</strong></div>
                        <div class="card-body">
                            <h3 class="card-text" id="data-nationality" align="center"></h3>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card border-primary mb-3" style="max-width: 18rem;">
                        <div class="card-header"><strong>Current Mood</strong></div>
                        <div class="card-body">
                            <div class="container-fluid" id="data-image">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <script>
        function onSignIn(googleUser) {
            const googleToken = googleUser.getAuthResponse().id_token;
            $.ajax({
                url: "http://localhost:3000/googleLogin",
                method: "POST",
                data: {
                    googleToken
                }
            })
                .done(response => {
                    localStorage.setItem('access_token', response.access_token)
                    showContentPage()
                })
                .fail(err => {
                    console.log(err);
                })
        }
        /* google */
        if (localStorage.getItem('access_token')) {
            showContentPage()
        } else {
            showSignInPage()
        }

        function showSignInPage() {
            $(".preloader").hide();
            $("#signIn-page").show()
            $("#signUp-page").hide()
            $("#content-page").hide()
        }

        function showSignUpPage() {
            $(".preloader").hide();
            $("#signIn-page").hide()
            $("#signUp-page").show()
            $("#content-page").hide()
        }

        function showContentPage() {
            $(".preloader").hide();
            $("#signIn-page").hide()
            $("#signUp-page").hide()
            $("#content-page").show()
        }

        function signin() {
            let email = $("#signin-email").val()
            let password = $("#signin-password").val()

            $.ajax({
                type: "POST",
                url: "http://localhost:3000/login",
                data: {
                    email,
                    password
                }
            })
                .done(data => {
                    localStorage.setItem('access_token', data.access_token)
                    showContentPage()
                })
                .fail((xhr, text) => {
                    console.log(text)
                })
                .always(() => {
                    $("#f-signIn").trigger("reset")
                })
        }

        function signup() {
            let name = $("#signup-name").val()
            let email = $("#signup-email").val()
            let password = $("#signup-password").val()

            $.ajax({
                type: "POST",
                url: "http://localhost:3000/register",
                data: {
                    name,
                    email,
                    password
                }
            })
                .done(data => {
                    console.log(data)
                    showSignInPage()
                })
                .fail((xhr, text) => {
                    console.log(text)
                })
                .always(() => {
                    $("#f-signUp").trigger("reset")
                })
        }

        function signout() {
            localStorage.clear()
            showSignInPage()
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
                console.log('User signed out.');
            });
            $("#data-gender").empty()
            $("#data-age").empty()
            $("#data-nationality").empty()
            $("#data-image").empty()
        }

        function getdata() {
            let name = $("#content-name").val()
            $(".preloader").show();
            $.ajax({
                type: 'POST',
                url: "http://localhost:3000/predict",
                data: {
                    name: name
                },
                headers: {
                    access_token: localStorage.getItem('access_token')
                }
            })
                .done(data => {
                    $(".preloader").fadeOut();
                    $("#data-gender").empty()
                    $("#data-age").empty()
                    $("#data-nationality").empty()
                    $("#data-image").empty()
                    $("#data-gender").append(`${data.gender}`)
                    $("#data-age").append(`${data.age}`)
                    $("#data-nationality").append(`${data.country}`)
                    $("#data-image").append(`<img src=${data.url} alt="" class="img-fluid">`)
                })
                .fail((xhr, text) => {
                    $(".preloader").fadeOut();
                    console.log(text)
                })
                .always(() => {
                    $("#form-content").trigger("reset")
                })
        }

        $(document).ready(function () {
            $("#form-signIn").on("submit", (e) => {
                e.preventDefault()
                signin()
            })
            $("#form-signUp").on("submit", (e) => {
                e.preventDefault()
                signup()
            })
            $("#form-signOut").on("submit", (e) => {
                e.preventDefault()
                signout()
            })
            $("#form-content").on("submit", (e) => {
                e.preventDefault()
                getdata()
            })
            $("#link-signUp").on("click", (e) => {
                e.preventDefault()
                showSignUpPage()
            })
            $("#link-signIn").on("click", (e) => {
                e.preventDefault()
                showSignInPage()
            })
        })
    </script>
</body>

</html>

<!-- #FFA863 -->